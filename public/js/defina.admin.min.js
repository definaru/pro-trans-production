// var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
// var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
//   return new bootstrap.Tooltip(tooltipTriggerEl)
// });

new Vue({
    el: '#admin',
    data: {
        isOpen: true,
        expand: false,
        loading: true,
        newCart: null,
        card: [],
        count: 0,
        summa: 0,
        show: null
    },
    computed: {
        totalSum: function () {
            var sum = this.card.reduce(
                (acc, current) => acc + Number(current.price), 0
            );
            this.summa = (parseInt(sum * 100)) / 100;
            //this.promocode === 'AI777' ? sum-100 : sum; 
            // parseInt(sum).toFixed(2)            
        }
    },
    mounted() {
        this.card = JSON.parse(localStorage.getItem('cart')) || [];
        if (localStorage.getItem('cart')) {
            try {
                setTimeout(function () {
                    this.loading = false;
                }.bind(this), 500);
                var goods = JSON.parse(localStorage.getItem('cart'));
                var set = new Set(goods.map(JSON.stringify));
                var uniqArray = Array.from(set).map(JSON.parse);
                this.card = uniqArray;
            } catch(e) {
                localStorage.removeItem('cart');
                console.log('Error:', e)
            }
        }
    },
    methods: {
        priceFormat: function(digital) {
            const num = parseInt(digital).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ")
            const cent = digital.toString().split('.')[1];
            return num+'.'+cent+' ₽'
        },
        getStartLink(url) {
            window.location.assign(url);
        },
        countGoods(n,s1,s2,s3, b = false) {
            let m = n % 10; j = n % 100;
            if(b) {n = n;}
            if(m==0 || m>=5 || (j>=10 && j<=20)) {return s3;}
            if(m>=2 && m<=4) {return s2;}
            return s1;
        },
        toggleSubMenu() {
            if(!this.isOpen) {
                this.isOpen = !this.isOpen;
            }
        },
        toggleMenu() {
            this.isOpen = !this.isOpen;
        },
        toggleExpandLess() {
            this.expand = !this.expand;
        },
        addToCard(e) {
            var added = JSON.parse(localStorage.getItem('cart'));
            var arr = added ? added : [added];
            const el = document.querySelector('#card'+e);
            //var valu = e.target.dataset.card;
            const {...card} = el.dataset.card.split(',');
            const add = {
                id: card[0],
                article: card[1],
                name: card[2],
                count: card[3],
                price: card[4]
            }
            console.log('to card: ', add);
            var total = arr.filter(el => el != null).concat(add);
            toastr.success(`Товар "${card[2]}" добавлен в корзину`, "Успешно", {
                positionClass:"toast-bottom-left",
                containerId:"toast-bottom-left"
            });
            localStorage.setItem('cart', JSON.stringify(total));
            this.card.push(add);
            this.saveCart();
        },
        addCat() {
            if (!this.newCart) {
                return;
            };
            this.card.push(this.newCart);
            this.newCart = '';
            this.saveCart();
        },
        removeCart(x) {
            this.card.splice(x, 1);
            this.saveCart();
        },
        saveCart() {
            const parsed = JSON.stringify(this.card);
            localStorage.setItem('cart', parsed);
        }
    }
});

$(function(){
	$('#inner-content').slimScroll({
		height: '570px',
        size: '3px',
        alwaysVisible: false
	});
});