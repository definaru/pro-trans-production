new Vue({
    el: '#admin',
    data: {
        id: '',
        design: 'grid',
        mobileMenuOpen: false,
        isOpen: true,
        expand: false,
        loading: true,
        newCart: null,
        close: false,
        send: false,
        сheckout: [],
        preсheckout: [],
        card: [],
        preorder: [],
        result: [],
        count: 0,
        totalsumma: 0,
        show: null,
        vin: '',
        spares: '',
        message: '',
        address: '',
        view_password: false,
        amount: 0,
        preamount: 0,
        description: '',
        active: 0,
        search: '',
        header: '',
        brand: '',
        array: '',
        edit: false,
        isError: '',
        stock: {
            store: {
                id: '',
                name: ''
            },
            country: {
                id: '',
                name: ''
            },
            progressbar: 0,
            progress: 0,
            result: '',
            size: '',
            loader: false,
            loading: false
        },
        goods: {
            image: '',
            delete: false,
            loading: false
        },
        promo: {
            file: '',
            pdf: '',
            editor: '',
            preview: {
                pdf: {
                    name: '',
                    size: ''
                },
                name: '',
                src: '',
                size: ''
            },
            error: {
                type: ''
            }
        },
        error: {
            message: false,
            vin: false,
            spares: false
        },
        card: {
            loading: true
        }
    },
    computed: {
        totalSum: function () {
            var sum = this.card.reduce(
                (acc, current) => acc + Number(current.summa), 0
            );
            this.totalsumma = sum
            //(parseInt(sum * 100)) / 100;           
        },
        totalAmount: function () {
            var value = this.card.reduce(
                (acc, current) => acc + Number(current.count), 0
            );
            this.amount = value;
        },
        totalPreAmount: function () {
            var value = this.preorder.reduce(
                (acc, current) => acc + Number(current.count), 0
            );
            this.preamount = value;
        }, 
        isValid () {
            return this.vin && this.spares
        },
        isValidate () {
            return this.header && this.brand
        },
        isValidMessage () {
            return this.message
        }

    },
    mounted() {
        this.card = JSON.parse(localStorage.getItem('cart')) || [];
        this.preorder = JSON.parse(localStorage.getItem('preorder')) || [];
        this.design = localStorage.getItem("design") || '';
        this.address = localStorage.getItem('address') || '';
        let cookie = document.cookie.match(/Pack=(.+?)(;|$)/);
        let cookieTrack = cookie === null ? 0 : cookie[1]
        this.stock.progressbar = cookieTrack || 0;

        this.getPromo();

        if (localStorage.getItem('cart')) {
            try {
                setTimeout(function () {
                    this.card.loading = false;
                }.bind(this), 500);
                var goods = JSON.parse(localStorage.getItem('cart'));
                var set = new Set(goods.map(JSON.stringify));
                var uniqArray = Array.from(set).map(JSON.parse);
                this.card = uniqArray;
            } catch(e) {
                localStorage.removeItem('cart');
                console.log('Error:', e)
            }
        }
        if (localStorage.getItem('preorder')) {
            try {
                setTimeout(function () {
                    this.loading = false;
                }.bind(this), 500);
                var goods = JSON.parse(localStorage.getItem('preorder'));
                var set = new Set(goods.map(JSON.stringify));
                var uniqArray = Array.from(set).map(JSON.parse);
                this.preorder = uniqArray;
            } catch(e) {
                localStorage.removeItem('preorder');
                console.log('Error:', e)
            }
        }
    },
    watch: {
        search: function(newQuestion, oldQuestion) {
            //console.log('newQuestion: ', newQuestion);
            if (newQuestion === 'а') { //  || newQuestion.includes('А')
                this.onChange(newQuestion) 
            }
        }
    },
    methods: {
        isCompleteStock() {
            this.stock.loading = true;
            let progress
            document.addEventListener('click', function(event) {
                if(event.target) {
                    progress = document.getElementById("progress");
                    let clock = createClock();
                    setInterval(clock, 3000);
                    function createClock() {
                        let sec = 0;
                        return function() {
                            sec++;
                            if (sec <= 100) {
                                progress.innerHTML = sec + '%'
                                progress.style.width = sec + '%'
                            }
                        }
                    }                      
                }
            });
        },
        async deleteImage(article, uuid) {
            this.goods.delete = false
            this.goods.image = '/img/placeholder.png'
            let headers = new Headers();
            let formdata = new FormData();
            formdata.append('uuid', uuid);
            formdata.append('name', article);
            let options = {
                method: 'POST',
                headers,
                body: formdata
            };
            const res = await fetch(`/api/files/delete`, options);
            const result = await res.json();
            if(result) {
                const {header, text} = result
                const position = {
                    positionClass: "toast-bottom-left",
                    containerId: "toast-bottom-left"
                }
                toastr.warning(text, header, position);                      
            }
        },
        async deleteImageFromGood(article, uuid) {
            Swal.fire({
                title: 'Внимание',
                text: "Уверены, что хотите удалить фотографию ?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#000',
                confirmButtonText: 'Да',
                cancelButtonText: 'Нет',
            }).then((result) => {
                if (result.isConfirmed) {
                    this.deleteImage(article, uuid)
                }
            });
        },
        async selectImageFromGood(e) {
            let file = e.target.files;
            let image = file[0];
            const el = document.querySelector('input[name="file"]');
            this.goods.loading = true
            let reader = new FileReader() 
            if (file) reader.readAsDataURL(image)
            reader.addEventListener('load', () => {
                this.goods.image = reader.result
            }, false);

            if(el) {
                let headers = new Headers();
                let formdata = new FormData();
                formdata.append('file', file[0], file[0].name);
                formdata.append('uuid', el.dataset.uuid);
                formdata.append('name', el.dataset.article);
                let options = {
                    method: 'POST',
                    headers,
                    body: formdata
                };
                const res = await fetch(`/api/files`, options);
                const result = await res.json();
                console.log("%c"+result.text, "border-radius: 2px; padding: 2px 4px; color: #fff; background-color: green")
                if(result) {
                    this.goods.loading = false
                    this.goods.delete = true
                    const {header, text, type} = result
                    const position = {
                        positionClass: "toast-bottom-left",
                        containerId: "toast-bottom-left"
                    }
                    type === 'success' ?
                        toastr.success(text, header, position) : 
                        toastr.error(text, header, position);                      
                }
            }
        },
        async handleExcelFile(e) {
            
            let file = e.target.files
            this.stock.loader = true
            let headers = new Headers();
            let formdata = new FormData();
            formdata.append("file", file[0], file[0].name);
            let options = {
                method: 'POST',
                headers,
                body: formdata
            };
            const res = await fetch(`/api/download/files`, options);
            const result = await res.json();
            this.stock.result = result
            if(result) {
                toastr.success(result.text, "Успешно", {
                    positionClass:"toast-bottom-left",
                    containerId:"toast-bottom-left"
                });
                this.stock.size = this.BytesToSize(result.size)
                this.stock.loader = false
                if(result.error === 0) {
                    window.location.assign(`/dashboard/admin/posting?excel=table.${result.extension}`);
                }
            }
        },
        handleStock(e) {
            //console.log('stock:', e.target)
            let select = form.stock;
            this.stock.store.name = select.options[select.selectedIndex].text
        },
        handleCountry(e) {
            //console.log('stock:', e.target)
            let select = form.country;
            this.stock.country.name = select.options[select.selectedIndex].text
        },

        handleFileSelect(e) {
            let file = e.target.files
            let f = file[0]
            if (file) {
                this.promo.preview.name = f.name
                this.promo.preview.size = this.BytesToSize(f.size)
            }

            !f.type.match('image.*') ?
                this.promo.error.type = 'Только картинки формат .png и .jpg' :
                this.promo.error.type = ''

            let reader = new FileReader() 
            reader.addEventListener('load', () => {
                this.promo.preview.src = reader.result
            }, false)

            if (file) reader.readAsDataURL(f)
        },
        FilePDF(e) {
            let file = e.target.files
            let f = file[0]
            if (file) {
                this.promo.preview.pdf.name = f.name
                this.promo.preview.pdf.size = this.BytesToSize(f.size)
            }
        },
        BytesToSize(bytes) {
            const sizes = ['Bt', 'KB', 'MB', 'GB', 'TB']
            if (!bytes) return '0 Bt'
            const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)))
            return Math.round(bytes / Math.pow(1024, i)) + ' ' + sizes[i]
        },
        onEditSubmit() {

        },        
        onSubmit() {
            if (!this.isValidate) return false;
            this.loading = false;
            this.addPromo();
        },
        async onCreateSubmit(data)
        {
            const {id, brand, header} = data
            var headers = new Headers();
            headers.append('Cookie', document.cookie);

            var formdata = new FormData();
            formdata.append("uuid", id);
            formdata.append("brand", brand);
            formdata.append("header", header);

            var options = {
                method: 'POST',
                headers,
                body: formdata,
                redirect: 'follow'
            };
            const res = await fetch(`/api/create/promo`, options);
            const result = await res.json();
            if(result.error) {
                this.isError = result
                this.loading = true
            } else {
                this.result.push(data)
                this.header = this.brand = ''
                this.loading = true              
            }
        },
        async getPromo() {
            this.loading = false
            const res = await fetch(`/api/all/promo`);
            const data = await res.json();
            this.result = data
            this.loading = true
        },     
        addPromo() {
            let data = {
                uuid: Math.round(Date.now()/3),
                header: this.header,
                brand: this.brand,
                created_at: (new Date()).toLocaleString()
            }
            this.onCreateSubmit(data);
        },
        viewPromo(id) {
            this.edit = !this.edit
            this.array = this.result.filter(data => data.stock === id)[0]
            let tag
            document.addEventListener('click', function(event) {
                if(event.target) {
                    tag = document.querySelector('#promoedit')
                    if(tag !== '') {
                        ClassicEditor
                            .create(tag, {
                                placeholder: 'Описание...'
                            })
                            .then(editor => {
                                this.edit !== true ? editor.destroy() : editor
                            })
                            .catch(error=>{
                                console.error(error);
                            });
                    } 
                    // else {
                    //     document.querySelector('.ck-editor__editable').ckeditorInstance.destroy()
                    //     // ClassicEditor.create( tag )
                    //     //     .then(editor => editor.destroy())
                    //     //     .catch(err => console.error( err ))                         
                    // }
                }
            });
        },
        async deletePromo(id) {
            this.result = this.result.filter((e) => e.uuid !== id)
            const res = await fetch(`/api/delete/promo/${id}`);
            const data = await res.json();
            console.log('id:', id);
            console.log(data);
            //this.result = data
        },
        onChange(e) {
            //const ru_en = {"а":"z","А":"z"}
            this.search[0] = 'd'
            console.log('The new value is: ', this.search);
            console.log('The value is: ', e);
            // this.search += ru_en[String.fromCharCode(e.which || e.keyCode)] || String.fromCharCode(e.which || e.keyCode);
            // return simvolbar[simvolbar.indexOf(this.search) + 1];
            // event.target.value
        },
        isGrid() {
            this.design = 'grid'
            localStorage.setItem('design', 'grid');
        },
        isLine() {
            this.design = 'line'
            localStorage.setItem('design', 'line');
        },
        addMaskPhone() {
            new Cleave('.input-phone', {
                prefix: '+7',
                phone: true,
                phoneRegionCode: 'RU'
            });
        },
        async blockContract(e) {
            this.loading = true
            var headers = new Headers();
            headers.append('Cookie', document.cookie);
            var formdata = new FormData();
            var options = {
                method: 'POST',
                headers,
                body: formdata,
                redirect: 'follow'
            };
            const res = await fetch(`/api/block/${e}`, options);
            const data = await res.text();
            if(data) {
                toastr.success(`Статус изменён`, "Успешно", {
                    positionClass:"toast-bottom-left",
                    containerId:"toast-bottom-left"
                });
                this.active = 2
                this.loading = false
            }
        },
        async activeContract(e) {
            this.loading = true
            var headers = new Headers();
            headers.append('Cookie', document.cookie);
            var formdata = new FormData();
            var options = {
                method: 'POST',
                headers,
                body: formdata,
                redirect: 'follow'
            };

            const res = await fetch(`/api/active/${e}`, options);
            const data = await res.text();
            if(data) {
                toastr.success(`Статус изменён`, "Успешно", {
                    positionClass:"toast-bottom-left",
                    containerId:"toast-bottom-left"
                });
                this.active = 1
                this.loading = false
            }
        },
        onChange: async function () {
            var update = this.address ? 'update' : 'no update'
            await this.$nextTick()
            if(update === 'update') {
                localStorage.setItem('address', this.address)
            }  
        },
        inPreCrement(id) {
            var item = this.preorder.find(item => item.id === id);
            item.count++;
            item.summa = parseFloat(item.summa)*Number(item.count);
            this.savePreOrder();
        },
        dePreCrement(id) {
            var item = this.preorder.find(item => item.id === id);
            item.count--;
            item.summa = parseFloat(item.summa)*Number(item.count);
            this.savePreOrder();            
        },
        resultSumma(sum, count)
        {
            var summa = Number.parseInt((sum * 100) / 100).toFixed(2)*Number(count)
            return this.priceFormat(summa)
        },
        inCrement(id) {
            var item = this.card.find(item => item.id === id);
            item.count++;
            item.summa = Number.parseInt((item.price * 100) / 100).toFixed(2)*Number(item.count);
            this.saveCart();
        },
        deCrement(id) {
            var item = this.card.find(item => item.id === id);
            item.count--;
            item.summa = Number.parseInt((item.price * 100) / 100).toFixed(2)*Number(item.count);
            this.saveCart();
        },
        priceFormat: function(digital) { // parseFloat()
            var rub = digital.toString().substr(0, String(digital).length-2)
            var cent = digital.toString().substr(-2)
            var num = rub+'.'+cent
            var result = new Intl.NumberFormat("ru-RU", {
                style: "currency",
                currency: "RUB",
                minimumFractionDigits: 2,
                currencyDisplay: "symbol",
            }).format(num);
            return result
        },
        getTotalsumma(digital) {
            var rub = digital.toString().substr(0, String(digital).length-2).replace(/\B(?=(\d{3})+(?!\d))/g, " ");
            var cent = digital.toString().slice(-2);
            return rub+'.'+cent+' ₽';
        },
        getStartLink(url) {
            window.location.assign(url);
        },
        countGoods(n,s1,s2,s3, b = false) {
            let m = n % 10; j = n % 100;
            if(b) {n = n;}
            if(m==0 || m>=5 || (j>=10 && j<=20)) {return s3;}
            if(m>=2 && m<=4) {return s2;}
            return s1;
        },
        toggleSubMenu() {
            if(!this.isOpen) {
                this.isOpen = !this.isOpen;
            }
        },
        toggleMenuMobile()
        {
            this.mobileMenuOpen = !this.mobileMenuOpen;
            console.log(this.mobileMenuOpen);
            var el = document.getElementById('admin');
            if(this.mobileMenuOpen === false) {
                el.classList.remove('panel-open');
                el.classList.add('panel');
            } else {
                el.classList.remove('panel');
                el.classList.add('panel-open');   
            }
        },
        toggleMenu() {
            var el = document.getElementsByClassName("show")[0];
            this.isOpen = !this.isOpen;
            if(this.isOpen === false) {
                el.classList.remove('show');
            }
        },
        toggleExpandLess() {
            this.expand = !this.expand;
        },
        addToOrder(e) {
            var added = JSON.parse(localStorage.getItem('preorder'));
            var arr = added ? added : [added];
            const el = document.querySelector('#preorder'+e);
            const {...order} = el.dataset.order.split(',');
            const add = {
                id: order[0],
                article: order[1],
                name: order[2],
                count: order[3],
                price: order[4]
            }
            console.log('to card: ', add);
            var total = arr.filter(el => el != null).concat(add);
            toastr.success(
                `<a href="/dashboard/account" class="text-white text-decoration-none">Товар "${order[2]}" отправлен в предзаказ</a>`, 
                `<a href="/dashboard/account" class="text-white text-decoration-none">Успешно</a>`, 
                {
                    positionClass:"toast-bottom-left",
                    containerId:"toast-bottom-left"
                });
            localStorage.setItem('preorder', JSON.stringify(total));
            this.preorder.push(add);
            this.savePreOrder();
        },
        addToCard(e) {
            var added = JSON.parse(localStorage.getItem('cart'));
            var arr = added ? added : [added];
            const el = document.querySelector('#card'+e);
            const {...card} = el.dataset.card.split(',');
            const add = {
                id: card[0],
                article: card[1],
                name: card[2],
                count: card[3],
                price: card[4],
                summa: card[5],
                image: card[6]
            }
            var total = arr.filter(el => el != null).concat(add);
            toastr.success(
                `<a href="/dashboard/card" class="text-white text-decoration-none">Товар "${card[2]}" добавлен в корзину</a>`, 
                `<a href="/dashboard/card" class="text-white text-decoration-none">Успешно</a>`, 
            {
                positionClass:"toast-bottom-left",
                containerId:"toast-bottom-left"
            });
            localStorage.setItem('cart', JSON.stringify(total));
            this.card.push(add);
            this.saveCart();
        },
        addCat() {
            if (!this.newCart) {
                return;
            };
            this.card.push(this.newCart);
            this.newCart = '';
            this.saveCart();
        },
        removeCart(x) {
            this.card.splice(x, 1);
            this.saveCart();
        },
        removePreOrder(x) {
            this.preorder.splice(x, 1);
            this.savePreOrder();
        },
        saveCart() {
            const parsed = JSON.stringify(this.card);
            localStorage.setItem('cart', parsed); 
        },
        savePreOrder() {
            const parsed = JSON.stringify(this.preorder);
            localStorage.setItem('preorder', parsed); 
        },
        rootsObjectValues(goods) {
            return Object.values(goods).map((value) => ({
                quantity: Number(value.count),
                price: Number(value.price),
                discount: 0,
                vat: 20,
                assortment: {
                    meta: {
                        href: `https://online.moysklad.ru/api/remap/1.2/entity/product/${value.id}`,
                        type: "product",
                        mediaType: "application/json"
                    }
                },
                reserve: 0
            }));
        },
        async editText(uuid)
        {
            this.loading = false
            var headers = new Headers();
            
            let description = document.querySelector('.ck-content').innerHTML;
            headers.append('Cookie', document.cookie);

            var formdata = new FormData();
            formdata.append("uuid", uuid);
            formdata.append("description", description);

            var options = {
                method: 'POST',
                headers,
                body: formdata,
                redirect: 'follow'
            };

            const res = await fetch('/api/description', options);
            const data = await res.text();
            if(data) {
                toastr.success(`Описание обновлено`, "Успешно", {
                    positionClass:"toast-bottom-left",
                    containerId:"toast-bottom-left"
                });
                this.loading = true
            }
        },
        async preCheckout(x) {
            toastr.success('Ваш заказ получен.', 'Успешно', {
                positionClass:"toast-bottom-left",
                containerId:"toast-bottom-left"
            });
            const roots = this.rootsObjectValues(this.preorder);
            var name = +new Date();
            var cart = {
                name: '00'+(name).toString().slice(-5),
                description: `${x}`,
                organization: {
                    meta: {
                        href: 'https://online.moysklad.ru/api/remap/1.2/entity/organization/218c26ab-33fe-11ed-0a80-0285001db7b3',
                        type: 'organization',
                        mediaType: 'application/json'
                    }
                },
                agent: {
                    meta: {
                        href: `https://online.moysklad.ru/api/remap/1.2/entity/counterparty/${x}`,
                        type: 'counterparty',
                        mediaType: 'application/json'
                    }
                },
                state: {
                    meta: {
                        href: `https://online.moysklad.ru/api/remap/1.2/entity/internalorder/metadata/states/1c8246e7-8845-11ed-0a80-04de00b11370`,
                        metadataHref: `https://online.moysklad.ru/api/remap/1.2/entity/internalorder/metadata`,
                        type: 'state',
                        mediaType: 'application/json'
                    },
                    id: '1c8246e7-8845-11ed-0a80-04de00b11370',
                    accountId: '213fbb41-33fe-11ed-0a80-08210000b632',
                    name: 'Новый',
                    color: 15106326,
                    stateType: 'Regular',
                    entityType: 'internalorder'
                },
                store: {
                    meta: {
                        href: 'https://online.moysklad.ru/api/remap/1.2/entity/store/218d258b-33fe-11ed-0a80-0285001db7b5',
                        metadataHref: 'https://online.moysklad.ru/api/remap/1.2/entity/store/metadata',
                        type: 'store',
                        mediaType: 'application/json'
                    }
                },
                meta: {
                    href: 'https://online.moysklad.ru/api/remap/1.2/entity/contract/75596eee-8ce6-11ed-0a80-014201c33820',
                    metadataHref: 'https://online.moysklad.ru/api/remap/1.2/entity/contract/metadata',
                    type: 'contract',
                    mediaType: 'application/json'
                }
            };
            var positions = {
                positions: roots
            };

            this.preсheckout = Object.assign({}, cart, positions);
            setTimeout(function () {
                localStorage.removeItem('preorder');
            }.bind(this), 1000);
        },
        async Checkout(x) {

            const roots = this.rootsObjectValues(this.card);
            var cart = {
                organization: {
                    meta: {
                        href: 'https://online.moysklad.ru/api/remap/1.2/entity/organization/218c26ab-33fe-11ed-0a80-0285001db7b3',
                        type: 'organization',
                        mediaType: 'application/json'
                    }
                },
                agent: {
                    meta: {
                        href: `https://online.moysklad.ru/api/remap/1.2/entity/counterparty/${x}`,
                        type: 'counterparty',
                        mediaType: 'application/json'
                    }
                },
            };
            var positions = {
                positions: roots
            };

            this.сheckout = Object.assign({}, cart, positions);
            setTimeout(function () {

                toastr.success('Ваш заказ получен.', 'Успешно', {
                    positionClass:"toast-bottom-left",
                    containerId:"toast-bottom-left"
                });

                localStorage.removeItem('cart');
            }.bind(this), 1000);
        },
        Send() {
            if(this.isValid) {
                setTimeout(function () {
                    this.loading = true
                }.bind(this), 2000);
            }
            if(!this.vin) {
                this.error.vin = true
            }
            if(!this.spares) {
                this.error.spares = true
            }
        },
        Sender() {
            if(this.isValidMessage) {
                setTimeout(function () {
                    this.loading = true
                }.bind(this), 2000);
            }
            if(!this.message) {
                this.error.message = true
            }
        },
        async SendManager(reports)
        {
            var ModalEl = document.getElementById('manager');
            var modal = bootstrap.Modal.getInstance(ModalEl)
            if(!this.isValidMessage) return false;
            this.loading = true;
            var formdata = new FormData();
            formdata.append('reports', reports);
            formdata.append('message', this.message);

            setTimeout(function () {
                modal.hide();
                toastr.success('Ваша заявка принята.', 'Успешно', {
                    positionClass:"toast-bottom-left",
                    containerId:"toast-bottom-left"
                });
            }.bind(this), 1000);

            this.send = true

            var requestOptions = {
                method: 'POST',
                body: formdata,
                redirect: 'follow'
            };

            const response = await fetch('/api/manager', requestOptions)
                .finally(() => this.loading = false);
            const result = await response.text();
            return result;
        },
        async Save()
        {
            if (!this.isValid) return false;
            this.loading = true;
            var formdata = new FormData();
            var ModalEl = document.getElementById('vinModal');
            var modal = bootstrap.Modal.getInstance(ModalEl)

            formdata.append("vin", this.vin);
            formdata.append("spares", this.spares);
            //var raw = JSON.parse(JSON.stringify(formdata));
            
            setTimeout(function () {
                modal.hide();
                toastr.success(`Ваша заявка принята.`, "Успешно", {
                    positionClass:"toast-bottom-left",
                    containerId:"toast-bottom-left"
                });
            }.bind(this), 1000);
            this.send = true


            var requestOptions = {
                method: 'POST',
                body: formdata,
                redirect: 'follow'
            };

            const response = await fetch('/api/spares', requestOptions)
                .finally(() => this.loading = false);
            const result = await response.text();
            return result;
        }
    }
});

$(function(){
	$('#inner-content').slimScroll({
		height: '570px',
        size: '3px',
        alwaysVisible: false
	});
});




function getStartLink(url) {
    window.location.assign(url);
}


const download = document.getElementById('upd_download');
if(download){
    var win = window.open("", '_blank');
    win.document.location = download.innerText;
    setTimeout(() => {
        win.close();
    }, 2000);
}

document.querySelectorAll('input[list]').forEach( (formfield) => {
    var datalist = document.getElementById(formfield.getAttribute('list'));
    var lastlength = formfield.value.length;
    var checkInputValue = function (inputValue) {
        if (inputValue.length - lastlength > 1) {
            datalist.querySelectorAll('option').forEach( function (item) {
            if (item.value === inputValue) {
                formfield.form.submit();
            }
            });
        }
        lastlength = inputValue.length;
    };
    formfield.addEventListener('input', function () {
        checkInputValue(this.value);
    }, false);
});


function loadGoods()
{
    Swal.fire({
        icon: false,
        title: false,
        showConfirmButton: false,
        allowOutsideClick: false,
        html: `
        <div class="d-flex align-items-center gap-3 btn icon-link justify-content-center mt-2">
            <span class="spinner-border spinner-border text-danger"></span>
            <span>Загружаем товар...</span>
        </div>
        `,
    });    
}

function selectOffset() {
    loadGoods();
    var url = document.getElementById("selectOffset").value;
    window.location.assign(url);
}

function selectOffsetButtom() {
    loadGoods();
    var url = document.getElementById("selectOffsetButtom").value;
    window.location.assign(url);
}